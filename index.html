<!DOCTYPE html>
<html>
<head>
    <title>Save Work</title>
</head>
<body>
    <button id="saveButton">Save Work to Download</button>

    <script>
        // Initialize data structure (replace with your actual data structure)
        let data = {
            // Your data structure here
            // Example:
            analysis: "Sample analysis",
            timestamp: new Date().toISOString()
        };

        // Main save function with error handling
        function saveWork() {
            try {
                if (!data) {
                    throw new Error('No data available to save');
                }

                // Create the blob with proper error handling
                const blob = new Blob([JSON.stringify(data, null, 2)], { 
                    type: 'application/json'
                });

                // Create download link
                const url = URL.createObjectURL(blob);
                const downloadLink = document.createElement('a');
                
                // Set download attributes
                downloadLink.href = url;
                downloadLink.download = `paragraph-analysis-${new Date().toISOString()}.json`;
                
                // Append link to body, click, and remove
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                // Clean up the URL object after a short delay
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                }, 100);

            } catch (error) {
                console.error('Error saving work:', error);
                alert('There was an error saving your work. Please try again.');
            }
        }

        // Add event listener when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            const saveButton = document.getElementById('saveButton');
            if (saveButton) {
                saveButton.addEventListener('click', saveWork);
            }
        });
    </script>
</body>
</html>
